# meeting _20251118_170858

# 1) Kiến trúc lưu trữ & quyền truy cập

- **SharePoint “sitio” riêng cho dự án**: tạo một **carpeta** (thư mục) chuyên biệt, cấp quyền **edición** (sửa) cho **cuenta del robot**; dùng làm kho dùng chung: tài liệu, templates, outputs (CSV, cartas PDF). Tránh lẫn với repo vận hành hiện tại.
- **OneDrive vs SharePoint**: tránh lệ thuộc đồng bộ cục bộ; **khuyến nghị dùng API Microsoft (Graph/SharePoint REST)** để robot truy xuất trực tiếp, giảm lỗi sync/lock. Cần **TI** bật **Integration Service**/kết nối ứng dụng.
- **Nguyên tắc**: robot chỉ **consumir** (đọc) từ repo scripting hiện có; **outputs** (CSV, cartas firmadas) để ở vị trí thống nhất do dự án quản lý.

# 2) Nguồn dữ liệu (9 “fuentes”) & tần suất

- 3 **tệp Excel động** từ **SAP scripting**:
    - **ZMLISPE** (*listado de pedidos* – danh sách đơn/HĐ),
    - **M3L** (contratos),
    - **ZMRval** (evaluaciones de proveedores – lịch sử đăng ký đánh giá trong SAP, có **consecutivo de evaluación**).
        
        Các file này cập nhật **2 lần/ngày** (10:00 và ~15:00, T2–T6).
        
- **SQL**: bảng **Documento de Garantía** (khóa nối **Número de contrato SAP**). Phát hiện **nhiều giá trị nulo** ở dữ liệu cũ (2016–2017) → cần rà soát/clean.
- **Tablas estáticas** (đặt trong carpeta dự án):
    - **Maestra criterio SST** (Seguridad y Salud en el Trabajo – an toàn & sức khỏe nghề nghiệp): *tipo de garantía* áp dụng **chỉ ID 7 & 17** ⇒ xác định **aplica SST**.
    - **Evaluadores SST** (theo **sociedad**),
    - **Maestro de colaboradores** (administradores de contrato),
    - **Maestro de aprobadores** (**jefatura de área**) – cần bổ sung trường **número de necesidad** để map chính xác,
    - **Encargados de Medio Ambiente** (theo **sociedad**),
    - **Lista correo de Compliance** (nhận notificación khi **incumple Código de Ética**).

# 3) Logic kích hoạt đánh giá (gatillos)

- **HĐ > 1 năm**: đánh giá **mỗi năm** (mỗi “cumple año”).
- **HĐ < 1 năm**: đánh giá **trước 20 ngày** so với **fin de validez**.
- **Luôn 20 ngày “de corrido”** (không phải días hábiles) trước mốc; **đánh giá thêm khi kết thúc HĐ** (nếu chưa tròn năm).
- Dùng **consecutivo de evaluación** từ **ZMRval** để hiển thị số **control** (trên carta/Power App): **consecutivo + 1** cho lần đánh giá sắp tạo.
- Cơ chế **chống “detonar” lại**: chỉ tái kích hoạt nếu chưa có “check” **terminado** (CSV+carta) **và** chưa có bản ghi **evaluación** mới trong SAP.

# 4) Phân vai & điều kiện “aplica”

- **Administrador de contrato**: luôn trả lời nhóm **Calidad/Gestión** (và **Medio Ambiente** nếu **no aplica**).
- **SST**: xác định **aplica** từ **tipo de garantía** (IDs 7, 17). Nếu **no aplica**, vẫn có “criterio global” để **administrador** tick mức mặc định (tránh lệch tổng điểm).
- **Medio Ambiente**: **administrador** chọn “aplica/no aplica”; nếu **aplica**, hệ thống tự chọn **encargado** theo **sociedad** (không yêu cầu nhập email thủ công).

# 5) Power App – UI, bảo mật & dữ liệu hiển thị

- **Autenticación** qua **Azure AD** (correo corporativo); **solo personas involucradas** hợp đồng mới truy cập/đánh giá.
- Màn hình: **Encabezado** (thông tin HĐ) + **Cuerpo** (criterios & subcriterios). **Valores/escala** chấm điểm sẽ gửi **borrador mới** (thang/ponderaciones sắp cập nhật).
- **Inputs** từ người dùng: *aplica/no aplica Medio Ambiente*, các **criterios**/**subcriterios** (tick/selector); phần còn lại là **datos fijos** từ *cruce* các fuentes.

# 6) CSV, cartas PDF & báo cáo

- **CSV** (Consolidado 1): bao gồm tổng điểm **Calidad**, **SST**, **Medio Ambiente**, các trường định danh HĐ, v.v.; **sugerencia nombre** file: `<NroDocumento>_<Consecutivo>_<Año>.csv`.
- **Cartas PDF**: tạm thời **luôn generar** (bỏ ý tưởng toggle để tránh phức tạp). **Administrador** ký; **jefatura de área** **aprueba** (phê duyệt) trước khi tiếp tục. **Compliance** chỉ nhận **notificación** khi **Código de Ética** bị **incumplido**.
- **Reporte mensual (Excel)** cho **Jorge** (CC **Yaruska**): tạo **ngày 1–3 hàng tháng**, gồm thống kê tổng & chi tiết (số HĐ đủ điều kiện, đã đánh giá, **plan de mejora** <80, …). Lưu bản sao ở SharePoint và **enviar por correo**. Ngoài ra có **control diario** trạng thái từng evaluación (truy vết tiến độ).

# 7) Những **điểm cần chú ý** (risks/acciones)

1. **Quyền & API**: sớm làm việc với **TI/Orlando** để cấp quyền **API Microsoft** (Graph/SharePoint, Dataverse nếu dùng) & cấu hình ứng dụng (Azure). Đây là **điều kiện lên producción**.
2. **Dữ liệu nulo** (SQL **Documento de Garantía**): có nulos ở bản ghi cũ → cần **data audit** + quy tắc fallback; xác thực khóa nối **Número de contrato SAP** ổn định từ **2022** trở đi.
3. **RUT/código responsable técnico**: có **padding ceros**/format khác nhau, **sin dígito verificador** (không dùng DV). Chuẩn hóa để join chính xác với **Maestro de colaboradores**.
4. **Aprobadores (jefatura)**: phải bổ sung **número de necesidad** vào layout xuất từ SAP scripting để map đúng **área** → **firma/aprobación**.
5. **Lock file**: nếu người dùng mở file Excel trên SharePoint, robot có thể **không “pisar”** (ghi đè) được → thiết kế cơ chế **retry**/**copias de trabajo** để tránh kẹt.
6. **Repositorio único**: mọi **tablas estáticas** (SST, evaluadores, aprobadores, Medio Ambiente, Compliance mails…) phải nằm trong **carpeta del proyecto** để **trazabilidad** & **mantenimiento** thống nhất.
7. **Dataverse/DB de soporte**: cân nhắc **Dataverse** (chuẩn Power Platform) hoặc **SQL** riêng làm **estado del proceso** (tránh “gộp” vào DB nghiệp vụ hiện tại). Cần **TI** tư vấn & chấp thuận.
8. **Escalas/Ponderaciones**: đội nghiệp vụ (**Jorge & Yaruska**) sẽ gửi **borrador** mới (text & thang điểm). Dev có thể tạm dùng **valores por defecto** để dựng UI/flow trước.

---